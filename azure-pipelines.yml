trigger:
      - main

stages:
- stage: BuildApp
  displayName: "Build and Publish ASP.NET App"
  jobs:
  - job: Build
    pool:
      vmImage: 'ubuntu-latest'
    steps:
    - task: UseDotNet@2
      inputs:
        packageType: 'sdk'
        version: '8.0.411' # or your required version
    

    - task: DotNetCoreCLI@2
      inputs:
        command: 'restore'
        projects: '**/*.csproj'

    - task: DotNetCoreCLI@2
      inputs:
        command: 'build'
        projects: '**/*.csproj'

    - task: DotNetCoreCLI@2
      inputs:
        command: 'publish'
        publishWebProjects: true
        arguments: '--configuration Release --output $(Build.ArtifactStagingDirectory)'
        zipAfterPublish: true

    - publish: $(Build.ArtifactStagingDirectory)
      artifact: drop

# # 3. DEPLOY
# - stage: DeployApp
#   displayName: "Deploy to Azure App Service"
#   dependsOn: BuildApp
#   jobs:
#   - job: Deploy
#     pool:
#       vmImage: 'windows-latest'
#     steps:
#     - download: current
#       artifact: drop

#     - task: AzureWebApp@1
#       inputs:
#         azureSubscription: 'YOUR-AZURE-SERVICE-CONNECTION'
#         appType: 'webApp'
#         appName: '$(APP_SERVICE_NAME)' # Output from Terraform
#         package: '$(Pipeline.Workspace)/drop/**/*.zip'
